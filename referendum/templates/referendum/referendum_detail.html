{% extends 'base.html' %}
{% load static %}

{% block main_title %}
    {{ object.title|capfirst }}
{% endblock %}

{% block content %}
    {% include 'referendum/snippets/referendum_vote_errors.html' %}
    <div class="jumbotron white-transp-bg">
        <div class="d-flex justify-content-end" style=" font-size: 2em;">
            {% include 'referendum/snippets/referendum_elements/referendum_like_button.html' %}
            {% include 'referendum/snippets/referendum_elements/referendum_owner_indicator.html' %}
        </div>
        <h1 class="text-center text-truncate">
            {{ object.question|capfirst }}
        </h1>
        <p class="lead">
            {% for categorie in referendum.categories.all %}
                <a href="{% url 'category' categorie.slug %}"
                   class="badge white-text {% cycle 'bluefr-bg' 'redfr-bg' 'greyfr-bg' 'blue2-bg' 'blue3-bg' %}"
                   data-toggle="tooltip" data-placement="top"
                   title="Voir les {{ categorie.nb_published_referendums }} référendum(s) de la catégorie {{ categorie }}">
                    {{ categorie }} <small>({{ categorie.nb_published_referendums }})</small>
                </a>
            {% endfor %}
            <span class="float-md-right">
            {% include 'referendum/snippets/referendum_elements/referendum_publication_date.html' %}
            {% include 'referendum/snippets/referendum_elements/referendum_event_date.html' %}
            {% include 'referendum/snippets/referendum_elements/referendum_has_voted.html' %}
        </span>
        </p>

        {% if referendum.is_in_progress and can_vote and valid_token and not already_voted %}
            <hr class="my-4">
            <div>
                {% include 'referendum/snippets/generic_form.html' %}
            </div>
        {% endif %}
        {% include 'referendum/snippets/referendum_results_block.html' %}
        <hr class="my-4">
        <p class="description-break text-justify">{{ object.description }}</p>
        <hr class="my-4">
        <div class="lead">
            {% if referendum.get_updatable_fields and referendum.creator == user %}
                <a href="{% url 'referendum_update' referendum.slug %}" class="btn bluefr-bg white-text">
                    {% if referendum.is_published %}
                        Planifier le vote
                    {% else %}
                        Mettre à jour
                    {% endif %}
                </a>
                {% if not referendum.is_published %}
                    <br>
                    <small class="text-muted">
                        Note: Le vote ne pourra être planifié que lorsque le référendum aura été publié.
                    </small>
                {% endif %}
                {% if referendum.is_published and not referendum.is_in_progress and not referendum.is_over %}
                    <br>
                    <small class="text-muted">
                        Note: Le date de vote reste modifiable jusqu'à la veille de la date de vote actuellement fixée.
                    </small>
                {% endif %}
            {% endif %}
        </div>
    </div>

    {% include 'referendum/snippets/comments.html' %}


{% endblock %}

{% block custom_js %}
    <script src="{% static 'custom/js/generic_request.js' %}"></script>
    <script src="{% static 'custom/js/toggle_hide.js' %}"></script>
    <script src="{% static 'custom/js/like.js' %}"></script>
    <script src="{% static 'custom/js/comment_event_listeners.js' %}"></script>
    <script src="{% static 'custom/js/comment_card_add_event_listener.js' %}"></script>
    <script src="{% static 'custom/js/add_comment.js' %}"></script>
{% endblock %}
